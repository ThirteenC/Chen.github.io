(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14c65354"],{"07ac":function(e,t,i){var a=i("23e7"),o=i("6f53").values;a({target:"Object",stat:!0},{values:function(e){return o(e)}})},"09f4":function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),Math.easeInOutQuad=function(e,t,i,a){return e/=a/2,e<1?i/2*e*e+t:(e--,-i/2*(e*(e-2)-1)+t)};var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function o(e,t){t?document.querySelector(t).scrollTop=e:(document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e)}function n(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function r(e,t,i,r){var s=n(),l=e-s,c=20,d=0;t="undefined"===typeof t?500:t;var u=function e(){d+=c;var n=Math.easeInOutQuad(d,s,l,t);o(n,i),d<t?a(e):r&&"function"===typeof r&&r()};u()}},"15fd":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i("a4d3"),i("b64b");function a(e,t){if(null==e)return{};var i,a,o={},n=Object.keys(e);for(a=0;a<n.length;a++)i=n[a],t.indexOf(i)>=0||(o[i]=e[i]);return o}function o(e,t){if(null==e)return{};var i,o,n=a(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)i=r[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}},3123:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var a=i("b775");function o(){return a["a"].get("/token")}},"400c":function(e,t,i){},"58a6":function(e,t,i){"use strict";i("400c")},"6f53":function(e,t,i){var a=i("83ab"),o=i("e330"),n=i("df75"),r=i("fc6a"),s=i("d1e7").f,l=o(s),c=o([].push),d=function(e){return function(t){var i,o=r(t),s=n(o),d=s.length,u=0,f=[];while(d>u)i=s[u++],a&&!l(o,i)||c(f,e?[i,o[i]]:o[i]);return f}};e.exports={entries:d(!0),values:d(!1)}},"72bc":function(e,t,i){"use strict";var a=i("d4ec"),o=i("bee2"),n=(i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("b0c0"),i("ac1f"),i("1276"),i("b680"),function(){function e(t,i){return Object(a["a"])(this,e),this.video=document.createElement("video"),this.video.preload="metadata",this.video.src=URL.createObjectURL(t),this.init(t,i)}return Object(o["a"])(e,[{key:"init",value:function(e,t){var i=this;return new Promise((function(a){var o=i.fileLengthFormat(e.size,t),n=i.getFileType(e.name);"mp4"===n?i.video.onloadedmetadata=function(){window.URL.revokeObjectURL(i.video.src);var e=i.video.duration;a({fileSize:o,duration:e,type:n,height:i.video.videoHeight,width:i.video.videoWidth})}:a({fileSize:o,duration:0,type:n,height:i.video.videoHeight,width:i.video.videoWidth})}))}},{key:"getFileType",value:function(e){var t=e.split("."),i="";return void 0!==t&&(t.length<=1&&e.indexOf("=")>-1?(console.log("输入是文件地址：",t),!1):(i=t[t.length-1],i=i.toLowerCase(),i))}},{key:"fileLengthFormat",value:function(e,t){var i,a=e/1024;if(a>1e3)return this.fileLengthFormat(a,++t);switch(t){case 1:i=a.toFixed(2);break;case 2:i=a.toFixed(2);break;case 3:i=a.toFixed(2);break;case 4:i=a.toFixed(2);break}return+i}}]),e}());t["a"]=n},"83d4":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-form",{attrs:{inline:!0,model:e.search}},[i("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.onAddOrUpdate()}}},[e._v(" 本地"+e._s(e.$t("table.add"))+" ")])],1)],1),i("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.onHandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"我的广告",name:"my",disabled:e.loading}},[i("div",{staticClass:"app-content"},[i("div",{staticClass:"tab-box"},[i("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.onHandlePos},model:{value:e.activePosName,callback:function(t){e.activePosName=t},expression:"activePosName"}},e._l(e.adsPosOptions,(function(e,t){return i("el-tab-pane",{key:t,attrs:{label:e.label,name:"pos_"+e.value}})})),1)],1),i("div",{staticClass:"app-box"},[0===e.list.length?i("el-empty",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{description:"暂无数据"}}):i("div",{staticClass:"all-card"},e._l(e.list,(function(t,a){return i("el-card",{key:a,staticClass:"box-card",attrs:{shadow:"hover"}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticStyle:{position:"relative"}},[i("div",[e._v(" "+e._s(t.pos?t.pos.name:"")+" ")]),i("div",{staticStyle:{position:"absolute",right:"0",top:"0"}},[1===t.url_type?i("el-link",{attrs:{href:t.url,type:"primary",target:"_blank"}},[e._v(e._s(e._f("paraphrase")(t.url_type,e.adTypeOptions)))]):i("el-link",{attrs:{underline:!1}},[e._v(e._s(e._f("paraphrase")(t.url_type,e.adTypeOptions)))])],1)])]),i("div",{staticClass:"card-content"},[i("el-image",{staticClass:"image-item",attrs:{src:t.image&&e.domin+t.image,"preview-src-list":[t.image&&e.domin+t.image]}},[i("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[i("i",{staticClass:"el-icon-picture-outline"})])]),i("div",{staticClass:"ellipsis new-title"},[e._v(" "+e._s(t.title)+" ")])],1),i("div",{staticClass:"card-footer"},[i("section",{on:{click:function(i){return e.onAddOrUpdate(t)}}},[i("i",{staticClass:"el-icon-edit-outline",staticStyle:{color:"#409eff"}})]),i("section",{on:{click:function(i){return e.onDelete(t)}}},[i("i",{staticClass:"el-icon-delete",staticStyle:{color:"#f56c6c"}})])])])})),1)],1)])])],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.pages.total>0,expression:"pages.total > 0"}],attrs:{total:e.pages.total,page:e.pages.current,limit:e.pages.limit},on:{"update:page":function(t){return e.$set(e.pages,"current",t)},"update:limit":function(t){return e.$set(e.pages,"limit",t)},pagination:function(t){return e.getList()}}}),e.addOrUpdateVisible?i("add-or-update",{ref:"addOrUpdate",on:{refreshList:function(t){return e.getList()}}}):e._e(),e.imageViewer?i("el-image-viewer",{attrs:{"on-close":e.closeViewer,"url-list":e.imageViewerList}}):e._e()],1)},o=[],n=i("5530"),r=(i("ac1f"),i("841c"),i("d3b7"),i("d81d"),i("fb6a"),i("99af"),i("b0c0"),i("1276"),i("333d")),s=i("15fd"),l=i("b775"),c=["id"];function d(e){return l["a"].get("/ads",{params:e})}function u(e){return l["a"].get("/ads/template",{params:e})}function f(e){return l["a"].get("/ads/pos",{params:e})}function m(e){var t=e.id,i=Object(s["a"])(e,c),a="POST",o="/ads";return t>0&&(a="PUT",o+="/".concat(t),i.id=t),Object(l["a"])({url:o,method:a,data:i})}function p(e){return l["a"].delete("/ads/".concat(e))}var v=i("5f87"),g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:e.form.id?e.$t("table.edit"):e.$t("table.add"),visible:e.visible},on:{"update:visible":function(t){e.visible=t},closed:function(t){return e.onClose()}}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"广告标识",prop:"pos_id"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.pos_id,callback:function(t){e.$set(e.form,"pos_id",t)},expression:"form.pos_id"}},e._l(e.posList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"广告类型",prop:"url_type"}},[i("el-radio-group",{model:{value:e.form.url_type,callback:function(t){e.$set(e.form,"url_type",t)},expression:"form.url_type"}},[i("el-radio",{attrs:{label:0}},[e._v("静态展示")]),i("el-radio",{attrs:{label:1}},[e._v("外链广告")]),i("el-radio",{attrs:{label:2}},[e._v("内联广告")])],1)],1),0!==e.form.url_type?i("el-form-item",{attrs:{label:"广告链接",prop:"url"}},[i("el-input",{attrs:{placeholder:"请输入广告链接, 如："+(1===e.form.url_type?"http://www.baidu.com":"goods|商品ID"),clearable:""},model:{value:e.form.url,callback:function(t){e.$set(e.form,"url",t)},expression:"form.url"}})],1):e._e(),2===e.form.url_type?i("div",{staticClass:"notice"},[e._v(" 注意：选择内联广告时，请用以下方式输入 "),i("div",[e._v("1.盲盒详情:box|box_id")]),i("div",[e._v("2.藏品详情:goods|goods_id")])]):e._e(),i("el-form-item",{attrs:{label:"广告海报",prop:"image"}},[i("custom-upload",{attrs:{"class-name":"avatar-uploader"},on:{handleBeforeUpload:e.beforeAvatarUpload,handleSuccess:e.handleAvatarSuccess}},[e.form.image?i("img",{staticClass:"avatar",attrs:{src:e.domin+e.form.image}}):i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e.form.pos_id?i("p",[e._v(" 建议尺寸"+e._s(e._f("paraphrase")(e.form.pos_id,e.posList,"value","size"))+"，点击图片可替换 ")]):e._e()],1),i("el-form-item",{attrs:{label:"排序",prop:"sort"}},[i("el-input-number",{attrs:{min:0,placeholder:"排序"},model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){return e.onFormSubmit()}}},[e._v(" "+e._s(e.$t("table.confirm"))+" ")]),i("el-button",{on:{click:function(t){e.visible=!1}}},[e._v(" "+e._s(e.$t("table.cancel"))+" ")])],1)],1)},b=[],h=(i("caad"),i("d9e2"),i("e9c4"),i("a15b"),i("0eef")),_={name:"AddOrUpdate",components:{CustomUpload:h["a"]},data:function(){var e=this,t=function(t,i,a){!i&&[1,2].includes(e.form.url_type)?a(new Error("请输入广告连接")):a()};return{visible:!1,btnLoading:!1,domin:Object(v["c"])(v["a"]),posList:[],form:{id:0,pos_id:"",image:"",url:"",url_type:0,sort:0},rules:{url:[{validator:t,trigger:["blur","change"]}],pos_id:[{required:!0,message:"请选择广告标识",trigger:["blur","change"]}],image:[{required:!0,message:"请上传广告海报",trigger:["blur","change"]}]}}},methods:{init:function(e,t){if(this.visible=!0,this.posList=t.slice(1),e){if(e.stock)return this.form.id=0,this.form.image=e.image,!1;this.form=JSON.parse(JSON.stringify(e))}},onFormSubmit:function(){var e=this;this.$refs["form"].validate((function(t){if(t){e.btnLoading=!0;var i=Object.assign({},e.form);[0].includes(e.form.url_type)&&(i.url=""),m(i).then((function(t){var i=t.msg;e.$message.success(i),e.visible=!1,e.$emit("refreshList")})).catch((function(){e.btnLoading=!1}))}}))},onClose:function(){this.$reset()},handleAvatarSuccess:function(e,t){this.form.image=e.name},beforeAvatarUpload:function(e,t){var i=["image/jpeg","image/jpg","image/png","image/gif"],a=e.size/1024/1024<20;return i.includes(e.type)?a?void t(!0):(this.$message.error("上传图片大小不能超过 20M"),void t(!1)):(this.$message.error("上传图片只能是 "+i.join(",")+" 格式!"),void t(!1))},handleAvatarError:function(e){-1!==JSON.parse(e.message).error.indexOf("token")&&this.$message.error("上传功能已失效，请重新登录")}}},y=_,O=(i("9cea"),i("2877")),w=Object(O["a"])(y,g,b,!1,null,"482570a0",null),k=w.exports,L=i("08a9"),x={name:"Ad",components:{Pagination:r["a"],AddOrUpdate:k,ElImageViewer:L["a"]},data:function(){return{loading:!1,imageViewer:!1,addOrUpdateVisible:!1,previewVisible:!1,domin:Object(v["c"])(v["a"]),activePosName:"pos_",adsPosOptions:[],imageViewerList:[],activeName:"my",list:[],adTypeOptions:[{label:"静态展示",value:0},{label:"外链广告",value:1},{label:"内联广告",value:2}],search:{pos:""},pages:{total:0,limit:20,current:1}}},created:function(){this.init()},methods:{init:function(){this.getPosList(),this.getList()},getList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pages.current,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.loading){this.loading=i,1===t&&(this.pages.current=t),this.list=[];var a=d(Object(n["a"])(Object(n["a"])({page:t},this.search),{},{limit:this.pages.limit}));"stock"===this.activeName&&(a=u(Object(n["a"])(Object(n["a"])({page:t},this.search),{},{limit:this.pages.limit}))),a.then((function(t){0===t.code&&(e.list=t.data.data.map((function(t){return"stock"===e.activeName?Object.assign(t,{stock:!0}):Object.assign(t,{stock:!1})})),e.pages.total=t.data.total)})).catch((function(){})).finally((function(){e.loading=!1}))}},getPosList:function(){var e=this;f().then((function(t){var i=[{label:"全部",value:""}];e.adsPosOptions=i.concat(t.data.map((function(e){return{label:e.name,value:e.id,size:e.size}}))).slice(0,2)}))},onHandleClick:function(){this.getList(1)},onHandlePos:function(){this.search.pos=this.activePosName.split("_")[1],this.getList(1)},onDelete:function(e){var t=this,i=e.title,a=e.id;this.$confirm("确定对(#".concat(a,")[").concat(i,"]进行[删除]操作?"),"删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((function(){p(a).then((function(e){var i=e.msg,a=void 0===i?"删除成功":i;t.$message.success(a),t.init()})).catch((function(){}))})).catch((function(){}))},onAddOrUpdate:function(e){var t=this;this.addOrUpdateVisible=!0,this.$nextTick((function(){t.$refs.addOrUpdate&&t.$refs.addOrUpdate.init(e,t.adsPosOptions)}))},onPreview:function(e){this.imageViewerList=[this.domin+e.image],this.imageViewer=!0},closeViewer:function(){this.imageViewer=!1}}},j=x,C=(i("58a6"),Object(O["a"])(j,a,o,!1,null,"40b1d74b",null));t["default"]=C.exports},"9cea":function(e,t,i){"use strict";i("e4f6")},e4f6:function(e,t,i){}}]);